<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALGO SIGNAL SOUND - Live Coding Music for Fun and Learning</title>

    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1 class="logo">‚ñ∂ algoSignalSOUND</h1>
                <span class="tagline">live coding music for fun and learning</span>
            </div>
            <div class="header-right">
                <div class="bpm-control">
                    <label>BPM</label>
                    <input type="number" id="bpmInput" value="135" min="60" max="200" step="1">
                </div>
                <div class="transport-controls">
                    <button id="startBtn" class="btn btn-start">START</button>
                    <button id="stopBtn" class="btn btn-stop">STOP</button>
                </div>
                <button id="helpBtn" class="btn btn-help">HELP</button>
                <button id="examplesBtn" class="btn btn-examples">EXAMPLES</button>
                <button id="toggleAudioReactiveBtn" class="btn btn-fx" title="Toggle audio-reactive background">üé® BG FX</button>
                <div class="status">
                    <span id="statusText">ready</span>
                    <span id="cycleCount">cycle: 0</span>
                </div>
            </div>
        </header>

        <!-- Main Editor Area -->
        <main class="main-content">
            <div class="editor-container">
                <div class="editor-toolbar">
                    <span class="help-text">Ctrl+Enter: evaluate line or selection | Ctrl+.: stop selected lines | Ctrl+Space: autocomplete</span>
                    <div class="toolbar-buttons">
                        <button id="savePresetBtn" class="btn-save-preset" title="Save code to currently loaded preset">Save</button>
                        <select id="presetSelect" class="btn-preset" title="Load a preset">
                            <option value="">Load Preset...</option>
                        </select>
                        <button id="resetCodeBtn" class="btn-reset" title="Show all presets or restore default">Reset Code</button>
                    </div>
                </div>
                <textarea id="codeEditor">// PSYCHEDELIC PROGRESSIVE - 135 BPM üéµüéµ
// 1. Click START first!
// 2. Press Ctrl+Enter on each line to build the track
// 3. Modify and re-evaluate to change patterns live!

// ====== MINIMAL INTRO - Build up slowly ======

// Powerful kick (custom sample kick1-5)
d1(s("kick1*4").gain(0.85))

// Deep bass samples (psytrance rolling bassline bass1-5)
d2(s("bass1 ~ bass1 ~ bass2 ~ bass1 ~ bass3 ~ bass1 ~ bass2 ~ bass4 ~").gain(0.65))

// Soft hi-hats background (custom samples hat1-3)
d3(s("hat1*8").gain(0.25).pan(0.7))

// ====== ADD ENERGY - Progressive layers ======

// Faster hi-hats with variations (16th notes)
d3(s("hh*16").gain(0.3).pan(0.6).every(4, fast(2)))

// Trippy lead melody (psychedelic scales)
d4(note("c3 eb3 f3 g3 bb3 c4 bb3 g3").s("fm").gain(0.4).room(0.5).delay(0.25).pan(0.3))

// Off-beat claps (spatial movement)
d5(s("~ cp ~ ~ ~ cp ~ oh").gain(0.5).room(0.4))

// ====== FULL POWER - Peak time! ======

// Complex bassline (rolling triplets feel)
d2(note("c1 c1 d1 eb1 c1 d1 eb1 f1 c1 c1 eb1 d1 c1 eb1 f1 g1").s("fm").gain(0.55).lpf(650).room(0.15))

// High-energy acid lead (panned left)
d4(note("c4 eb4 f4 g4 bb4 c5 g4 f4").s("fm").gain(0.35).room(0.6).delay(0.3).pan(0.2))

// Snare on 2 and 4 (medium volume)
d6(s("~ ~ sd ~ ~ ~ sd ~").gain(0.6).room(0.3))

// Percussive accents (occasional)
d7(s("~ ~ ~ oh ~ ~ cp ~").gain(0.45).pan(0.8))

// ====== BREAKDOWN - Atmospheric ======

// Keep only kick + deep bass
d1(s("bd*4").gain(0.8))
d2(note("c1 ~ ~ ~ eb1 ~ ~ ~").s("fm").gain(0.45).lpf(500).room(0.4))
d3(silence())
d4(silence())
d5(silence())
d6(silence())
d7(silence())

// Add ambient pad slowly
d8(note("c3 eb3 g3 bb3").s("sine").gain(0.3).room(0.9).slow(2))

// Build tension with faster hi-hats
d3(s("hh*8").gain(0.2).pan(0.5).fast(2))

// ====== CLIMAX - Maximum energy! ======

// Powerful kick
d1(s("bd*4").gain(0.9))

// Insane rolling bassline
d2(note("c1 c1 d1 eb1 c1 d1 f1 eb1 c1 d1 eb1 f1 g1 f1 eb1 d1").s("fm").gain(0.6).lpf(700).room(0.2))

// Ultra-fast hi-hats (16th notes)
d3(s("hh*16").gain(0.35).pan(0.65).every(4, fast(2)))

// Psychedelic lead (alternating patterns)
d4(note("<c4 eb4 g4 bb4 c5 bb4 g4 eb4>").s("fm").gain(0.4).room(0.5).delay(0.25).pan(0.3))

// Claps and open hats
d5(s("~ cp ~ oh ~ cp ~ oh").gain(0.5).room(0.4).pan(0.7))

// Powerful snare
d6(s("~ ~ sd ~ ~ ~ sd ~").gain(0.7).room(0.3))

// Extra percussion texture
d7(s("~ ~ ~ ~ oh ~ ~ cp").gain(0.4).pan(0.8))

// ====== PSYCHEDELIC VARIATIONS ======

// Reverse bassline every 4 cycles (mind-bending!)
d2(note("c1 c1 d1 eb1 f1 g1 f1 eb1").s("fm").gain(0.6).every(4, rev()).lpf(600))

// Sometimes crazy fast hi-hats (50% chance)
d3(s("hh*16").gain(0.35).sometimes(fast(2)).pan(0.6))

// Alternate lead patterns
d4(note("<c4 eb4 f4 g4 bb4 g4 f4 eb4 | c5 bb4 g4 f4 eb4 f4 g4 bb4>").s("fm").gain(0.4).room(0.5).delay(0.2))

// ====== VOLUME CONTROL EXAMPLES ======

// Loud kick drum
d1(s("bd*4").gain(0.9))

// Quiet hi-hats in the background
d2(s("hh*8").gain(0.3).pan(0.7))

// Medium volume snare with reverb
d3(s("~ ~ sd ~").gain(0.6).room(0.5))

// Soft bassline
d4(note("c2 eb2 g2 bb2").s("sawtooth").gain(0.4).lpf(600))

// Mix: loud drums + quiet melody
d5(s("bd*4").gain(0.8))
d6(note("c4 e4 g4 bb4").s("fm").gain(0.3).room(0.5))

// Dynamic volume changes
d7(s("bd sd").gain(0.7))
d7(s("bd sd").gain(0.5))  // Re-evaluate to make it quieter

// ====== STOP CONTROLS ======

// Stop all
hush()

// Stop specific slots
d5(silence())
d6(silence())
</textarea>
            </div>

            <!-- Visualization Panel -->
            <aside class="viz-panel">
                <div class="panel-section">
                    <h3>Pattern Timeline</h3>
                    <canvas id="timeline" width="450" height="200"></canvas>
                </div>

                <div class="panel-section">
                    <h3>Oscilloscope</h3>
                    <canvas id="scope" width="450" height="100"></canvas>
                </div>

                <div class="panel-section">
                    <h3>Psychedelic Visuals üåÄ</h3>
                    <button id="psychedelicPopupBtn" class="btn-popup">
                        üîç Fullscreen Visuals
                    </button>
                    <canvas id="psychedelicCanvas" width="450" height="200" style="display: none;"></canvas>
                </div>

                <div class="panel-section">
                    <h3>Audio Info</h3>
                    <div class="audio-info" style="font-size: 0.75em; color: #808080;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <div class="metronome-led" id="metronomeLed"></div>
                            <span id="metronomeTempo">0 BPM</span>
                        </div>
                        <div>Context: <span id="audioContextState">-</span></div>
                        <div>Sample Rate: <span id="audioSampleRate">-</span></div>
                        <div>Latency: <span id="audioLatency">-</span>ms</div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>Master Effects</h3>
                    <div class="master-controls">
                        <div class="control-row">
                            <label>LPF (Hz)</label>
                            <input type="range" id="masterLPF" min="200" max="20000" value="20000" step="100">
                            <span id="masterLPFValue">20kHz</span>
                        </div>
                        <div class="control-row">
                            <label>HPF (Hz)</label>
                            <input type="range" id="masterHPF" min="20" max="500" value="20" step="10">
                            <span id="masterHPFValue">20Hz</span>
                        </div>
                        <div class="control-row">
                            <label>Reverb</label>
                            <input type="range" id="masterReverb" min="0" max="100" value="0" step="1">
                            <span id="masterReverbValue">0%</span>
                        </div>
                        <div class="control-row">
                            <label>Delay</label>
                            <input type="range" id="masterDelay" min="0" max="100" value="0" step="1">
                            <span id="masterDelayValue">0%</span>
                        </div>
                        <div class="control-row">
                            <label>Volume</label>
                            <input type="range" id="masterVolume" min="0" max="200" value="80" step="5">
                            <span id="masterVolumeValue">80%</span>
                        </div>
                        <button id="masterResetBtn" class="btn-master-reset">Reset Master</button>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>Active Patterns</h3>
                    <div id="activePatterns" class="pattern-list">
                        <div class="pattern-item empty">No patterns running</div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>Quick Reference</h3>
                    <div class="reference">
                        <strong>Slots (d1-d9):</strong><br>
                        <code>d1(s("bd sd"))</code> - slot 1<br>
                        <code>d2(note("c3"))</code> - slot 2<br>
                        <code>d1(silence())</code> - mute slot<br>
                        <br>
                        <strong>Patterns:</strong><br>
                        <code>s("bd sd hh")</code> - samples<br>
                        <code>note("c3 e3")</code> - notes<br>
                        <code>.fast(2)</code> - speed x2<br>
                        <code>bd*4</code> - repeat 4x<br>
                        <code>~</code> - rest<br>
                        <code>hush()</code> - stop all<br>
                        <br>
                        <strong>Effects:</strong><br>
                        <code>.gain(0.7)</code> - volume<br>
                        <code>.room(0.5)</code> - reverb<br>
                        <code>.delay(0.3)</code> - delay<br>
                        <code>.lpf(800)</code> - filter<br>
                        <code>.pan(0.5)</code> - pan<br>
                    </div>
                </div>
            </aside>
        </main>

        <!-- Console Output -->
        <div class="console">
            <div class="console-header">
                <span>Console</span>
                <button id="clearConsole" class="btn-clear">Clear</button>
            </div>
            <div id="consoleOutput" class="console-output">
                <div class="console-line success">‚úì AlgoSignalSound engine loaded</div>
                <div class="console-line info">‚ô™ Ready to code music...</div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>AlgoSignalSound - Help & Examples</h2>
                <button class="modal-close" id="closeHelpBtn">&times;</button>
            </div>
            <div class="modal-body">
                <section class="help-section">
                    <h3>üéµ Samples Audio Disponibles</h3>
                    <div class="samples-grid">
                        <div class="sample-item"><code>kick1</code> √† <code>kick5</code> - Kicks (folder: <code>kick db/</code>)</div>
                        <div class="sample-item"><code>sd1</code> √† <code>sd3</code> - Snares (folder: <code>snares sd/</code>)</div>
                        <div class="sample-item"><code>hh1</code>, <code>hh2</code>, <code>hat3</code> - Hi-hats (folder: <code>hats hh/</code>)</div>
                        <div class="sample-item"><code>bass1</code> √† <code>bass5</code> - Bass samples (folder: <code>bass/</code>)</div>
                        <div class="sample-item"><code>cp1</code> √† <code>cp3</code> - Claps (folder: <code>clap cp/</code>)</div>
                        <div class="sample-item"><code>perc1</code> √† <code>perc3</code> - Percussion (folder: <code>perc/</code>)</div>
                        <div class="sample-item"><code>fx1</code> √† <code>fx3</code> - FX / one-shots (folder: <code>fx/</code>)</div>
                        <div class="sample-item"><code>(custom/)</code> - Dossier vide: placez vos samples personnalis√©s ici</div>
                    </div>
                    <p style="margin-top: 1rem; font-size: 0.9em; opacity: 0.8;">
                        üí° Astuce: <code>s("kick1 kick2 kick3")</code> alterne entre les samples list√©s ci-dessus.
                        Vous pouvez √©galement appeler les tokens courts (ex. <code>sd</code>, <code>hh</code>, <code>cp</code>) si des fichiers correspondants existent.
                    </p>
                    <p style="margin-top: 0.5rem; font-size: 0.85em; opacity: 0.8;">
                        ‚ö†Ô∏è Mode sample-first activ√©: si aucun sample n'existe pour un raccourci (ex. <code>bd</code> ou <code>cp</code>), l'√©v√©nement peut √™tre silencieux.
                        Pour forcer l'utilisation du synth, pr√©fixez le nom par <code>synth:</code> (ex. <code>synth:clap</code>), ou placez un fichier d'alias dans <code>samples/</code>.
                    </p>
                </section>

                <section class="help-section">
                    <h3>üéπ Synth√©tiseurs Disponibles</h3>
                    <div class="samples-grid">
                        <div class="sample-item"><code>sine</code> - Onde sinuso√Ødale douce</div>
                        <div class="sample-item"><code>square</code> - Onde carr√©e (8-bit)</div>
                        <div class="sample-item"><code>sawtooth</code> - Onde dent de scie</div>
                        <div class="sample-item"><code>triangle</code> - Onde triangle</div>
                        <div class="sample-item"><code>fm</code> - Synth√®se FM (modulaire)</div>
                        <div class="sample-item"><code>am</code> - Synth√®se AM</div>
                    </div>
                </section>

                <section class="help-section">
                    <h3>üìù Syntaxe Mini-Notation</h3>
                    <div class="code-examples">
                        <div class="example-item">
                            <code>bd sd hh sd</code>
                            <span>4 sons espac√©s √©galement</span>
                        </div>
                        <div class="example-item">
                            <code>bd*4</code>
                            <span>R√©p√©ter 4 fois</span>
                        </div>
                        <div class="example-item">
                            <code>bd ~ sd ~</code>
                            <span>~ = silence/rest</span>
                        </div>
                        <div class="example-item">
                            <code>&lt;bd sd hh&gt;</code>
                            <span>Alternance chaque cycle</span>
                        </div>
                    </div>
                </section>

                <section class="help-section">
                    <h3>üéõÔ∏è Transformations de Patterns</h3>
                    <div class="code-examples">
                        <div class="example-item">
                            <code>.fast(2)</code>
                            <span>Doubler la vitesse</span>
                        </div>
                        <div class="example-item">
                            <code>.slow(2)</code>
                            <span>Ralentir de moiti√©</span>
                        </div>
                        <div class="example-item">
                            <code>.rev()</code>
                            <span>Inverser le pattern</span>
                        </div>
                        <div class="example-item">
                            <code>.every(4, fast(2))</code>
                            <span>Tous les 4 cycles</span>
                        </div>
                    </div>
                </section>

                <section class="help-section">
                    <h3>üéöÔ∏è Effets Audio</h3>
                    <div class="code-examples">
                        <div class="example-item">
                            <code>.gain(0.5)</code>
                            <span>Volume (0-2, d√©faut 1.0)</span>
                        </div>
                        <div class="example-item">
                            <code>.room(0.5)</code>
                            <span>Reverb (0-1)</span>
                        </div>
                        <div class="example-item">
                            <code>.delay(0.3)</code>
                            <span>Delay/Echo (0-1)</span>
                        </div>
                        <div class="example-item">
                            <code>.lpf(1000)</code>
                            <span>Filtre passe-bas (Hz)</span>
                        </div>
                        <div class="example-item">
                            <code>.pan(0.7)</code>
                            <span>Panoramique (-1 √† 1)</span>
                        </div>
                    </div>
                </section>

                <section class="help-section">
                    <h3>üéöÔ∏è Master Effects (Global)</h3>
                    <p>Ces effets s'appliquent √† TOUT l'audio (tous les slots).</p>
                    <div class="code-examples">
                        <div class="example-item">
                            <code>masterLPF(800)</code>
                            <span>Filtre passe-bas (att√©nue aigus)</span>
                        </div>
                        <div class="example-item">
                            <code>masterHPF(100)</code>
                            <span>Filtre passe-haut (coupe kicks/basses)</span>
                        </div>
                        <div class="example-item">
                            <code>masterReverb(0.5)</code>
                            <span>Reverb globale (0-1)</span>
                        </div>
                        <div class="example-item">
                            <code>masterDelay(0.3)</code>
                            <span>Delay global (0-1)</span>
                        </div>
                        <div class="example-item">
                            <code>masterVolume(0.8)</code>
                            <span>Volume master (0-2)</span>
                        </div>
                        <div class="example-item">
                            <code>masterCompressor(-20, 4)</code>
                            <span>Compressor (threshold, ratio)</span>
                        </div>
                        <div class="example-item">
                            <code>masterReset()</code>
                            <span>Reset tous les effets master</span>
                        </div>
                    </div>
                </section>

                <section class="help-section">
                    <h3>‚å®Ô∏è Raccourcis Clavier</h3>
                    <div class="code-examples">
                        <div class="example-item">
                            <code>Ctrl+Enter</code>
                            <span>√âvaluer la ligne courante OU les lignes s√©lectionn√©es</span>
                        </div>
                        <div class="example-item">
                            <code>Ctrl+.</code>
                            <span>Arr√™ter les slots s√©lectionn√©s</span>
                        </div>
                        <div class="example-item">
                            <code>Ctrl+Space</code>
                            <span>Autocompl√©tion (show all commands)</span>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Examples Modal -->
    <div id="examplesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üéµ EXAMPLES - Electronic & Psychedelic Music</h2>
                <button class="modal-close" id="closeExamplesBtn">&times;</button>
            </div>
            <div class="modal-body">
                <section class="help-section">
                    <h3>üéß Techno & House (120-135 BPM)</h3>

                    <div class="example-block">
                        <h4>Techno Minimal - Berlin Style</h4>
                        <pre><code>// Deep techno kick avec reverb
d1(s("bd*4").gain(0.8).room(0.2))

// Hi-hats subtils (16ths)
d2(s("hh*16").gain(0.25).pan(0.6))

// Claps sur les temps 2 et 4
d3(s("~ cp ~ cp").gain(0.5).room(0.4))

// Bassline hypnotique
d4(note("c2 ~ c2 ~ eb2 ~ c2 ~").s("sawtooth").lpf(500))</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Detroit Techno - Deep House</h4>
                        <pre><code>// Powerful kick 4-on-the-floor
d1(s("bd*4").gain(0.85))

// Shaker pattern
d2(s("hh*8 ~ hh*4").gain(0.3).pan(0.7))

// Sub bass wobble
d3(note("c1 c1 eb1 c1 f1 c1 eb1 c1").s("sine").lpf(300).gain(0.6))

// Chord stabs (every 8 beats)
d4(note("c3 eb3 g3").s("square").room(0.5).gain(0.4).slow(2))</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Acid House - TB-303 Style</h4>
                        <pre><code>// Classic 909 kick
d1(s("bd*4").gain(0.9))

// Acid bassline avec filtre qui bouge
d2(note("c2 ~ c2 d2 ~ eb2 ~ d2 c2 ~ d2 eb2 ~ f2 ~ eb2").s("sawtooth")
   .lpf(800).room(0.1).gain(0.6))

// Open hi-hat sur les off-beats
d3(s("~ oh ~ oh").gain(0.4).room(0.3))

// Claps avec delay
d4(s("~ ~ cp ~").delay(0.25).gain(0.5))</code></pre>
                    </div>
                </section>

                <section class="help-section">
                    <h3>üåÄ Psytrance (135-145 BPM)</h3>

                    <div class="example-block">
                        <h4>Full-On Psytrance - Morning Vibes</h4>
                        <pre><code>// Puissant kick psy (4-on-the-floor)
d1(s("bd*4").gain(0.95))

// Rolling bassline typique psy (16th notes) - AGGRESSIVE
d2(note("c1 c1 d1 eb1 c1 d1 f1 eb1 c1 d1 eb1 f1 g1 f1 eb1 d1").s("square")
   .lpf(700).gain(0.8).room(0.1))

// Hi-hats ultra-rapides (signature psytrance)
d3(s("hh*16").gain(0.35).pan(0.65).sometimes(fast(2)))

// Lead psych√©d√©lique avec delay - PLUS PUISSANT
d4(note("c4 eb4 g4 bb4 c5 bb4 g4 eb4").s("sawtooth")
   .room(0.5).delay(0.25).gain(0.5).pan(0.3))

// Off-beat claps et open hats
d5(s("~ cp ~ oh ~ cp ~ oh").gain(0.6).room(0.3))</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Dark Psytrance - Night Time</h4>
                        <pre><code>// Dark kick avec compression - PUISSANT
d1(s("bd*4").gain(1.0))

// Bassline sombre et lourde - AGGRESSIVE
d2(note("c1 ~ c1 ~ d1 ~ c1 ~ eb1 ~ c1 ~ d1 ~ f1 ~").s("square")
   .lpf(500).gain(0.85).room(0.05))

// Metallic hi-hats
d3(s("hh*16").gain(0.3).hpf(8000).pan(0.7))

// Lead industriel et agressif - PLUS FORT
d4(note("c3 ~ d3 ~ eb3 ~ f3 ~ g3 ~ f3 ~ eb3 ~ d3 ~").s("sawtooth")
   .lpf(1200).room(0.4).gain(0.6))

// Snare sur 2 et 4 - PUNCH
d5(s("~ ~ sd ~ ~ ~ sd ~").gain(0.75).room(0.2))</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Progressive Psytrance - Groovy</h4>
                        <pre><code>// Kick progressif - PUISSANT
d1(s("bd*4").gain(0.95))

// Bassline m√©lodique qui √©volue - SAWTOOTH AGGRESSIVE
d2(note("<c1 c1 d1 eb1 | d1 d1 eb1 f1>").s("sawtooth")
   .lpf(700).gain(0.75).room(0.15))

// Layers de hi-hats complexes
d3(s("hh*16").every(4, fast(2)).gain(0.35).pan(0.6))

// Atmosph√®re psych√©d√©lique - PLUS PR√âSENT
d4(note("c3 eb3 g3 bb3").s("triangle")
   .room(0.8).delay(0.3).gain(0.4).slow(2))

// Percussions tribales
d5(s("~ cp ~ ~ oh ~ cp ~").gain(0.6).pan(0.4))</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Psytrance Breakdown - Tension Builder</h4>
                        <pre><code>// Kick minimal
d1(s("bd*4").gain(0.7))

// Bassline espac√©e (cr√©er la tension)
d2(note("c1 ~ ~ ~ ~ ~ ~ ~").s("fm").lpf(500).room(0.4).gain(0.5))

// Pad atmosph√©rique qui monte
d3(note("c2 eb2 g2 bb2").s("sine")
   .room(0.9).gain(0.25).slow(4))

// Hi-hats qui s'acc√©l√®rent progressivement
d4(s("hh*8").fast(2).gain(0.2))
d4(s("hh*16").fast(2).gain(0.3))  // Re-evaluate pour build-up

// Reverse cymbal pour la tension
d5(s("oh").rev().room(0.6).slow(4))</code></pre>
                    </div>
                </section>

                <section class="help-section">
                    <h3>üçÑ Psychedelic & Goa Trance (138-148 BPM)</h3>

                    <div class="example-block">
                        <h4>Goa Trance Classique - 90s Style</h4>
                        <pre><code>// Kick puissant goa
d1(s("bd*4").gain(0.9))

// Bassline tribale et hypnotique
d2(note("c1 c1 d1 c1 c1 eb1 c1 c1 d1 c1 f1 c1 eb1 c1 d1 c1").s("fm")
   .lpf(600).gain(0.65).room(0.1))

// Lead acid avec beaucoup de reverb
d3(note("c3 d3 eb3 g3 bb3 c4 bb3 g3 eb3 d3 c3 d3 eb3 f3 g3 f3").s("sawtooth")
   .lpf(1500).room(0.6).delay(0.2).gain(0.4).pan(0.3))

// Hi-hats 16ths rapides
d4(s("hh*16").gain(0.3).pan(0.7))

// Percussions ethniques
d5(s("~ cp ~ ~ ~ oh ~ cp").room(0.4).gain(0.5))</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Forest Psytrance - Organic Vibes</h4>
                        <pre><code>// Kick organique
d1(s("bd*4").gain(0.85).room(0.1))

// Bassline glitchy et complexe
d2(note("c1 ~ c1 d1 ~ eb1 ~ d1 ~ c1 d1 ~ eb1 f1 ~ d1").s("triangle")
   .lpf(700).gain(0.6))

// Textures atmosph√©riques
d3(note("c3 eb3 f3 g3").s("sine")
   .room(0.9).delay(0.4).gain(0.25).slow(2))

// Hi-hats organiques avec variations
d4(s("hh*16").sometimes(fast(1.5)).rarely(rev()).gain(0.3).pan(0.6))

// Glitch percussion
d5(s("~ ~ oh ~ cp ~ ~ oh").fast(2).gain(0.4).room(0.5))</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Psychedelic Downtempo - Chill Vibes (90-110 BPM)</h4>
                        <pre><code>// Kick doux et profond
d1(s("bd ~ ~ bd ~ bd ~ ~").gain(0.7).room(0.3))

// Bassline dubby et spacieuse
d2(note("c2 ~ ~ ~ eb2 ~ ~ ~ g2 ~ ~ ~ eb2 ~ ~ ~").s("sine")
   .lpf(400).gain(0.6).room(0.5))

// Pad psych√©d√©lique qui flotte
d3(note("c3 eb3 g3 bb3").s("triangle")
   .room(0.9).delay(0.5).gain(0.3).slow(4))

// Hi-hats lents et spacieux
d4(s("hh ~ ~ hh ~ hh ~ ~").gain(0.25).room(0.6).pan(0.6))

// Effets sonores et textures
d5(note("c4 ~ g4 ~ eb4 ~ bb4 ~").s("fm")
   .room(0.8).delay(0.4).gain(0.2).slow(2))</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Trippy Soundscape - Ambiant Psych√©d√©lique</h4>
                        <pre><code>// Pas de kick - juste des textures
d1(note("c2 ~ ~ ~ eb2 ~ ~ ~ g2 ~ ~ ~ bb2 ~ ~ ~").s("sine")
   .room(0.9).gain(0.4).slow(4))

// Lead qui serpente avec delay infini
d2(note("c4 eb4 g4 bb4 c5 bb4 g4 eb4").s("fm")
   .room(0.8).delay(0.5).gain(0.3).slow(2))

// Atmosph√®re myst√©rieuse
d3(note("c3 eb3 f3 g3 bb3 c4").s("triangle")
   .room(0.95).gain(0.25).slow(8))

// Percussions tribales espac√©es
d4(s("~ ~ ~ oh ~ ~ cp ~").room(0.7).gain(0.3).slow(2))

// Reverse effects
d5(s("hh").rev().room(0.9).slow(4).gain(0.2))</code></pre>
                    </div>
                </section>

                <section class="help-section">
                    <h3>‚ö° Drum & Bass / Jungle (160-180 BPM)</h3>

                    <div class="example-block">
                        <h4>Neurofunk - Dark DnB</h4>
                        <pre><code>// Kick + snare breakbeat (signature DnB)
d1(s("bd ~ ~ ~ ~ ~ sd ~").gain(0.85))

// Bassline neuro complexe
d2(note("c1 ~ c1 d1 ~ eb1 ~ d1").s("sawtooth")
   .lpf(600).gain(0.7).room(0.1))

// Hi-hats rapides (double time)
d3(s("hh*8").gain(0.3).pan(0.6))

// Reese bass (sub bass modul√©)
d4(note("c1 ~ ~ ~ eb1 ~ ~ ~").s("triangle")
   .lpf(300).gain(0.65).room(0.05))</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Liquid DnB - Melodic & Smooth</h4>
                        <pre><code>// DnB breakbeat
d1(s("bd ~ sd bd ~ sd*2 bd ~").gain(0.8))

// Bassline liquide et m√©lodique
d2(note("c2 ~ eb2 ~ g2 ~ eb2 ~ bb2 ~ g2 ~").s("sine")
   .lpf(800).gain(0.6).room(0.3))

// Pads atmosph√©riques
d3(note("c3 eb3 g3 bb3").s("triangle")
   .room(0.8).gain(0.3).slow(2))

// Hi-hats doux
d4(s("hh*16").gain(0.25).room(0.4))</code></pre>
                    </div>
                </section>

                <section class="help-section">
                    <h3>üéõÔ∏è Techniques Avanc√©es</h3>

                    <div class="example-block">
                        <h4>Layering Multiple Patterns (Stack)</h4>
                        <pre><code>// Superposer plusieurs patterns dans un slot
d1(stack(
  s("bd*4").gain(0.8),
  s("hh*8").gain(0.3).pan(0.6),
  note("c2").s("fm").gain(0.5)
))</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Transformations Conditionnelles</h4>
                        <pre><code>// Reverse tous les 4 cycles
d1(s("bd sd hh cp").every(4, rev()))

// Fast parfois (50% chance)
d2(s("hh*8").sometimes(fast(2)))

// Rarely slow (25% chance)
d3(note("c3 e3 g3").s("sine").rarely(slow(2)))

// Often avec effet (75% chance)
d4(s("bd*4").often(x => x.room(0.5)))</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Alternance de Patterns (&lt;&gt;)</h4>
                        <pre><code>// Alterne entre deux patterns chaque cycle
d1(s("<bd*4 | bd*8>"))

// Alterne entre plusieurs m√©lodies
d2(note("<c3 e3 g3 | d3 f3 a3 | eb3 g3 bb3>").s("fm"))

// Combinaison d'alternances
d3(s("<bd sd | bd*4 | bd ~ bd sd>"))</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Effets Combin√©s - Sound Design</h4>
                        <pre><code>// Lead psych√©d√©lique complet
d1(note("c3 eb3 g3 bb3 c4").s("fm")
   .lpf(1200)        // Filtre passe-bas
   .room(0.6)        // Reverb spatiale
   .delay(0.25)      // Delay rythmique
   .pan(0.3)         // Pan √† gauche
   .gain(0.4))       // Volume contr√¥l√©

// Bass avec mouvement
d2(note("c1 c1 d1 eb1").s("sawtooth")
   .lpf(600)
   .room(0.1)
   .gain(0.7)
   .every(4, rev()))  // Reverse tous les 4 cycles</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Live Performance Tips</h4>
                        <pre><code>// Commencer minimal
d1(s("bd*4"))
d2(note("c1 ~ ~ ~").s("fm").lpf(500))

// Ajouter progressivement (live coding!)
d3(s("hh*8").gain(0.3))

// Build tension
d3(s("hh*16").fast(2).gain(0.4))

// Drop! Tout en m√™me temps
d1(s("bd*4").gain(0.9))
d2(note("c1 c1 d1 eb1").s("fm").lpf(700))
d3(s("hh*16").gain(0.35))
d4(note("c4 eb4 g4").s("fm").room(0.5))

// Retour au minimal
d3(silence())
d4(silence())

// Stop tout
hush()</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Master Effects - Transitions Cr√©atives</h4>
                        <pre><code>// Transition avec filtre master (psytrance style)
masterLPF(800)   // Att√©nue les aigus
masterLPF(500)   // Plus sombre
masterLPF(300)   // Tr√®s sombre
masterLPF(20000) // Retour normal (drop!)

// Couper les kicks/basses avec HPF
masterHPF(100)   // Coupe un peu les basses
masterHPF(200)   // Coupe beaucoup (plus de kick!)
masterHPF(20)    // Retour normal

// Breakdown atmosph√©rique
masterReverb(0.6)  // Beaucoup de reverb
masterDelay(0.4)   // Delay spacieux
masterHPF(150)     // Coupe les basses
// ... puis drop avec reset:
masterReset()      // Retour au son sec et puissant!

// Build-up avec volume
masterVolume(0.3)  // Tr√®s faible
masterVolume(0.5)  // Monte
masterVolume(0.7)  // Monte encore
masterVolume(1.0)  // Full power!

// Compression pour plus de punch
masterCompressor(-15, 6)  // Compression forte
masterCompressor(-25, 2)  // Compression l√©g√®re</code></pre>
                    </div>
                </section>

                <section class="help-section">
                    <h3>üéµ Quick Copy Templates</h3>
                    <p>Templates pr√™ts √† copier-coller et modifier :</p>

                    <div class="example-block">
                        <h4>Template Psytrance Complet</h4>
                        <pre><code>// === PSYTRANCE 140 BPM SET ===

// INTRO (minimal)
d1(s("bd*4").gain(0.8))
d2(note("c1 ~ ~ ~ c1 ~ ~ ~").s("fm").lpf(500))

// BUILD (ajouter layers)
d3(s("hh*8").gain(0.25))
d4(note("c3 eb3 g3").s("fm").room(0.5).slow(2))

// DROP (full power!)
d1(s("bd*4").gain(0.9))
d2(note("c1 c1 d1 eb1 c1 d1 f1 eb1").s("fm").lpf(700))
d3(s("hh*16").gain(0.35))
d4(note("c4 eb4 g4 bb4").s("fm").room(0.5).delay(0.25))
d5(s("~ cp ~ oh").gain(0.5))

// BREAKDOWN
d2(silence())
d3(silence())
d5(silence())

// OUTRO
hush()</code></pre>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Psychedelic Visuals Popup -->
    <div id="psychedelicPopup" class="psychedelic-popup" style="display: none;">
        <div class="psychedelic-popup-header">
            <h3>Psychedelic Visuals üåÄ</h3>
            <button id="psychedelicCloseBtn" class="btn-close">‚úï</button>
        </div>
        <canvas id="psychedelicCanvasPopup" width="1000" height="800"></canvas>
    </div>

    <!-- Libraries -->
    <!-- Filter console warnings BEFORE Tone.js loads -->
    <script>
        // Suppress benign browser policy warnings that appear before audio user gesture
        (function() {
            const originalWarn = console.warn;
            const originalError = console.error;
            
            console.warn = function(...args) {
                const msg = String(args[0] || '');
                if (msg.includes('AudioContext') || 
                    msg.includes('passive event listener')) {
                    return;
                }
                originalWarn.apply(console, args);
            };
            
            console.error = function(...args) {
                const msg = String(args[0] || '');
                if (msg.includes('AudioContext')) {
                    return;
                }
                originalError.apply(console, args);
            };
        })();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.css">

    <!-- App Scripts -->
    <script src="core/parser.js"></script>
    <script src="core/pattern.js"></script>
    <script src="audio/master.js"></script>
    <script src="audio/synths.js"></script>
    <script src="audio/samples.js"></script>
    <script src="audio/effects.js"></script>
    <script src="audio/scheduler.js"></script>
    <script src="editor/evaluator.js"></script>
    <script src="ui/slot-colors.js"></script>
    <script src="ui/visualizer.js"></script>
    <script src="ui/psychedelic.js"></script>
    <script src="ui/popup.js"></script>
    <script src="ui/editor-effects.js"></script>
    <script src="app.js"></script>
</body>
</html>
